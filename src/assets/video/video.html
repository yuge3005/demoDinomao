<!doctype html>
<html class="full-height">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Streaming Demo</title>
<script type="text/javascript" src="adapter-6.4.0.js" ></script>
<script type="text/javascript" src="webrtc.sky.js"></script>
	<style>
		.full-height{ height: 100%; }
		#remoteVideo{
			width: 100%;
			height: 100%;
			object-fit: fill;
		}
		video::-webkit-media-controls {
			display: none !important;
		}
	</style>

</head>

<body style="padding: 0; margin: 0;"  class="full-height">
<video id="remoteVideo" autoplay playsinline muted onplay="videoStart()"></video>
	<script>
		function sendVideoMessage( message ){
			var obj = {	value: message };
			window.parent.postMessage(JSON.stringify(obj), '*');
			try {
				window.webkit.messageHandlers.videoMessage.postMessage(message);
			} catch (error) {
				try{
					eval( "androidLogger.video(message)" );
				}
				catch (error) {}
			}
		}
		
		window.SLynx = new Skylynx();
		
		var streamReady = false;
		var hasStart = false;
		var stramPin;
		
		SLynx.init({
			videoObject:'remoteVideo',
			websocketAddress:"wss://webrtcserver.skylynx.io",
			turnAddress: "direct.skylynx.io:3478?transport=udp",
			turnUsername: "skylynx",
			turnCredential:"manager11",
			successCallback:function(){
				streamReady = true;
			},
			errorCallback:function(err){
				console.error(err);
			},
			debug:true
		});
		
		function change( i ){
			window.SLynx.stop();
			setTimeout( restart, 100, i );
		}
		function restart( i ){
			window.SLynx.start(i, stramPin);
		}
		
		function playVideo( stream, pin ){
			if( streamReady ){
				if(hasStart){
					hasStart = false;
					change( stream );
				}
				else{
					window.SLynx.start(stream, pin ? pin : "" );
					stramPin = pin;
				}
			}
			else{
				setTimeout( playVideo, 100, stream, pin );
			}
		}
		
		function videoStart(){
			sendVideoMessage( "videoLoaded" );
			hasStart = true;
		}
			</script>
</body>
</html>
