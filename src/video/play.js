var Skylynx=function(){this.debug=!1,this.init=function(e){this.errorCallback=e.errorCallback;var t=this.debug=e.debug,r=this.stopStream,a=this.log,n=this.error,s=this,o=$("#"+e.videoObject);Janus.init({debug:!!t&&"all",callback:function(){Janus.isWebrtcSupported()?s.janus=new Janus({server:e.server,success:function(){s.janus.attach({plugin:"janus.plugin.streaming",opaqueId:"streaming-"+Janus.randomString(12),success:function(t){s.streaming=t,a("Plugin attached! ("+s.streaming.getPlugin()+", id="+s.streaming.getId()+")"),e.successCallback()},error:function(t){t("  -- Error attaching plugin... ",e.errorCallback)},iceState:function(e){a("ICE state changed to "+e)},webrtcState:function(e){a("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:function(t,o){a(" ::: Got a message :::",t);var i=t.result;if(i){if(i.status){var u=i.status;"starting"===u?a("starting"):"started"===u?a("started"):"stopped"===u&&(a("stopped"),r(s))}else if("event"===t.streaming){i.substream;var c=i.temporal,l=i.spatial_layer;c=i.temporal_layer,null==l&&null==c||svcStarted||(svcStarted=!0)}}else if(t.error)return n(t.error,e.errorCallback),void r(s);if(o){a("Handling SDP as well...",o);var d=-1!==o.sdp.indexOf("stereo=1");s.streaming.createAnswer({jsep:o,media:{audioSend:!1,videoSend:!1,data:!0},customizeSdp:function(e){d&&-1==e.sdp.indexOf("stereo=1")&&(e.sdp=e.sdp.replace("useinbandfec=1","useinbandfec=1;stereo=1"))},success:function(e){a("Got SDP!",e);s.streaming.send({message:{request:"start"},jsep:e})},error:function(t){Janus.error("WebRTC error:",t),t("WebRTC error:"+t,e.errorCallback)}})}},onremotestream:function(t){if(a(" ::: Got a remote stream :::",t),0!==o.length){Janus.attachMediaStream(o.get(0),t);var r=t.getVideoTracks();r&&0!==r.length||setTimeout(function(){var r=t.getVideoTracks();r&&0!==r.length||n("No remote video available!",e.errorCallback)},1e4)}else n("HTML video object not found!",e.errorCallback)},ondataopen:function(e){Janus.log("The DataChannel is available!")},ondata:function(e){a("We got data from the DataChannel!",e)},oncleanup:function(){a("oncleanup")}})},error:function(e){console.error(e)},destroyed:function(){a("destroyed")}}):n("No WebRTC support... ",e.errorCallback)}})},this.start=function(e,t){this.startStream(e,t,this)},this.startStream=function(e,t,r){if(!e)return!1;var a={request:"watch",id:e,pin:t};r.streaming.send({message:a})},this.play=function(e){e.play().then(e=>{this.log("Stream started!")}).catch(e=>{this.error("Error: "+e,this.errorCallback)})},this.stopStream=function(e){e.streaming.send({message:{request:"stop"}}),e.streaming.hangup()},this.stop=function(){this.stopStream(this)},this.log=function(e){this.debug&&console.log(e)},this.error=function(e,t){console.error(e),t&&t(e)}};